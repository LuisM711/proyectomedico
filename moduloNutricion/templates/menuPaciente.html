{% extends 'layouts/nav.html' %}
{% load static %}
{% block content %}
{% if menu %}
<link rel="stylesheet" type="text/css" href="{% static 'css/menuPaciente.css' %}">
<table class="table  table-bordered border-primary border border-primary-subtle table-hover" id="tabla">
    <thead class="table-dark">
        <tr>
            <th><b>Comidas</b></th>
            <th><i class="fa-solid fa-carrot"></i> Verduras</th>
            <th><i class="fa-solid fa-apple-whole"></i> Frutas</th>
            <th><i class="fa-solid fa-wheat-awn"></i> Cereales</th>
            <th><i class="fa-solid fa-wheat-awn"></i> Leguminosas</th>
            <th><i class="fa-solid fa-bacon"></i> Origen Animal</th>
            <th><i class="fa-solid fa-mug-saucer"></i> Leche y Derivados</th>
            <th><i class="fa-solid fa-cheese"></i> Grasas</th>
            <th><i class="fa-solid fa-ice-cream"></i> Azúcares</th>
        </tr>
   </thead>
    <tr>
        <th><i class="fa-solid fa-egg"></i><p>Desayunos</p></th>
        <td>
            <input type="number" required min="0" required max="20" value="{{menu.desayuno.verduras}}" class="porciones" name="desaVerduras" disabled>
        </td>
        <td>
            <input type="number" required min="0" required max="20" value="{{menu.desayuno.frutas}}" class="porciones" name="desaFrutas" disabled>
        </td>
        <td>
            <input type="number" required min="0" required max="20" value="{{menu.desayuno.cereales}}" class="porciones" name="desaCereales" disabled>
        </td>
        <td>
            <input type="number" required min="0" required max="20" value="{{menu.desayuno.leguminosas}}" class="porciones" name="desaLeguminosas" disabled>
        </td>
        <td>
            <input type="number" required min="0" required max="20" value="{{menu.desayuno.origen}}" class="porciones" name="desaOrigen" disabled>
        </td>
        <td>
            <input type="number" required min="0" required max="20" value="{{menu.desayuno.leche}}" class="porciones" name="desaLeche" disabled>
        </td>
        <td>
            <input type="number" required min="0" required max="20" value="{{menu.desayuno.grasas}}" class="porciones" name="desaGrasas" disabled>
        </td>
        <td>
            <input type="number" required min="0" required max="20" value="{{menu.desayuno.azucares}}" class="porciones" name="desaAzucares" disabled>
        </td>
        
    </tr>
    <tr>
        <th><i class="fa-solid fa-apple-whole"></i><p>Colación</p></th>
        <td>
            <input type="number" required min="0" required max="20" value="{{menu.colacion.verduras}}" class="porciones" name="colaVerduras" disabled>
        </td>
        <td>
            <input type="number" required min="0" required max="20" value="{{menu.colacion.frutas}}" class="porciones" name="colaFrutas" disabled>
        </td>
        <td>
            <input type="number" required min="0" required max="20" value="{{menu.colacion.cereales}}" class="porciones" name="colaCereales" disabled>
        </td>
        <td>
            <input type="number" required min="0" required max="20" value="{{menu.colacion.leguminosas}}" class="porciones" name="colaLeguminosas" disabled>
        </td>
        <td>
            <input type="number" required min="0" required max="20" value="{{menu.colacion.origen}}" class="porciones" name="colaOrigen" disabled>
        </td>
        <td>
            <input type="number" required min="0" required max="20" value="{{menu.colacion.leche}}" class="porciones" name="colaLeche" disabled>
        </td>
        <td>
            <input type="number" required min="0" required max="20" value="{{menu.colacion.grasas}}" class="porciones" name="colaGrasas" disabled>
        </td>
        <td>
            <input type="number" required min="0" required max="20" value="{{menu.colacion.azucares}}" class="porciones" name="colaAzucares" disabled>
        </td>
    </tr> 
    <tr>
        <th><i class="fa-solid fa-drumstick-bite"></i><p>Comidas</p</th>
            <td>
                <input type="number" required min="0" required max="20" value="{{menu.comida.verduras}}" class="porciones" name="comiVerduras" disabled>
            </td>
            <td>
                <input type="number" required min="0" required max="20" value="{{menu.comida.frutas}}" class="porciones" name="comiFrutas" disabled>
            </td>
            <td>
                <input type="number" required min="0" required max="20" value="{{menu.comida.cereales}}" class="porciones" name="comiCereales" disabled>
            </td>
            <td>
                <input type="number" required min="0" required max="20" value="{{menu.comida.leguminosas}}" class="porciones" name="comiLeguminosas" disabled>
            </td>
            <td>
                <input type="number" required min="0" required max="20" value="{{menu.comida.origen}}" class="porciones" name="comiOrigen" disabled>
            </td>
            <td>
                <input type="number" required min="0" required max="20" value="{{menu.comida.leche}}" class="porciones" name="comiLeche" disabled>
            </td>
            <td>
                <input type="number" required min="0" required max="20" value="{{menu.comida.grasas}}" class="porciones" name="comiGrasas" disabled>
            </td>
            <td>
                <input type="number" required min="0" required max="20" value="{{menu.comida.azucares}}" class="porciones" name="comiAzucares" disabled>
            </td>
    
    </tr>
    <tr>
            <th><i class="fa-solid fa-apple-whole"></i><p>Colación</p></th>
            <td>
                <input type="number" required min="0" required max="20" value="{{menu.colacion2.verduras}}" class="porciones" name="colaVerduras2" disabled>
            </td>
            <td>
                <input type="number" required min="0" required max="20" value="{{menu.colacion2.frutas}}" class="porciones" name="colaFrutas2" disabled>
            </td>
            <td>
                <input type="number" required min="0" required max="20" value="{{menu.colacion2.cereales}}" class="porciones" name="colaCereales2" disabled>
            </td>
            <td>
                <input type="number" required min="0" required max="20" value="{{menu.colacion2.leguminosas}}" class="porciones" name="colaLeguminosas2" disabled>
            </td>
            <td>
                <input type="number" required min="0" required max="20" value="{{menu.colacion2.origen}}" class="porciones" name="colaOrigen2" disabled>
            </td>
            <td>
                <input type="number" required min="0" required max="20" value="{{menu.colacion2.leche}}" class="porciones" name="colaLeche2" disabled>
            </td>
            <td>
                <input type="number" required min="0" required max="20" value="{{menu.colacion2.grasas}}" class="porciones" name="colaGrasas2" disabled>
            </td>
            <td>
                <input type="number" required min="0" required max="20" value="{{menu.colacion2.azucares}}" class="porciones" name="colaAzucares2" disabled>
            </td>
    </tr> 
    <tr>
        <th><i class="fa-solid fa-mug-saucer"></i><p>Cenas</p></th>
        <td>
            <input type="number" required min="0" required max="20" value="{{menu.cena.verduras}}" class="porciones" name="cenaVerduras" disabled>
        </td>
        <td>
            <input type="number" required min="0" required max="20" value="{{menu.cena.frutas}}" class="porciones" name="cenaFrutas" disabled>
        </td>
        <td>
            <input type="number" required min="0" required max="20" value="{{menu.cena.cereales}}" class="porciones" name="cenaCereales" disabled>
        </td>
        <td>
            <input type="number" required min="0" required max="20" value="{{menu.cena.leguminosas}}" class="porciones" name="cenaLeguminosas" disabled>
        </td>
        <td>
            <input type="number" required min="0" required max="20" value="{{menu.cena.origen}}" class="porciones" name="cenaOrigen" disabled>
        </td>
        <td>
            <input type="number" required min="0" required max="20" value="{{menu.cena.leche}}" class="porciones" name="cenaLeche" disabled>
        </td>
        <td>
            <input type="number" required min="0" required max="20" value="{{menu.cena.grasas}}" class="porciones" name="cenaGrasas" disabled>
        </td>
        <td>
            <input type="number" required min="0" required max="20" value="{{menu.cena.azucares}}" class="porciones" name="cenaAzucares" disabled>
        </td>
    </tr> 
</table>
<button type="button" class="btn btn-primary" id="lista" onclick="openIngredientDialog()">Lista de Alimentos</button>
    <dialog id="alimentos">
        <div class="model-content">
            <div class="input-group mb-3" id="stBuscar">
                <input type="text" class="form-control"  id="inputBuscar" placeholder="Buscar alimento..." aria-label="Recipient's username" aria-describedby="button-addon2" onkeyup="filtrarTabla()">
                <!-- <button class="btn btn-outline-secondary" type="button" id="button-addon2" onclick="filtrarTabla()">Buscar</button> -->
              </div>

            <input type="button" class="close" value="X">
            <div class="btn-group" role="group" aria-label="Basic example">
                <button type="button" class="btn btn-primary" id="verduras" onclick="fetchCategoryData(1)"><i class="fa-solid fa-carrot"></i> Verduras</button>
                <button type="button" class="btn btn-primary" id="frutas" onclick="fetchCategoryData(2)"><i class="fa-solid fa-apple-whole"></i> Frutas</button>
                <button type="button" class="btn btn-primary" id="cereales" onclick="fetchCategoryData(3)"><i class="fa-solid fa-wheat-awn"></i> Cereales</button>
                <button type="button" class="btn btn-primary" id="leguminosas" onclick="fetchCategoryData(4)"><i class="fa-solid fa-wheat-awn"></i> Leguminosas</button>
                <button type="button" class="btn btn-primary" id="origen" onclick="fetchCategoryData(5)"><i class="fa-solid fa-bacon"></i> Origen Animal</button>
                <button type="button" class="btn btn-primary" id="leche" onclick="fetchCategoryData(6)"><i class="fa-solid fa-mug-saucer"></i> Leche</button>
                <button type="button" class="btn btn-primary" id="grasas" onclick="fetchCategoryData(7)"><i class="fa-solid fa-cheese"></i> Grasas</button>
                <button type="button" class="btn btn-primary" id="azucares" onclick="fetchCategoryData(8)"><i class="fa-solid fa-ice-cream"></i> Azúcares</button>
                <button type="button" class="btn btn-primary" id="libres" onclick="fetchCategoryData(9)"><i class="fa-solid fa-face-smile-wink"></i> Libres</button>
            </div>
            <div id="modalContent">
                
                <h1 id="h1"></h1>
            </div>
        </div>
    </dialog>
<div class="recomendaciones">
    <section class="recomendacion">
         <h2>Recomendaciones</h2>
        <textarea name="reco" id="" cols="50" rows="10" disabled>{{menu.recomendacion}}</textarea>
    </section>
</div>
<script>
    onload = async () => {
     await fetch("/api/types/")
            .then(response => {
                return response.json();
            })
            .then(data => {
                tipos = data;
                console.log(tipos);
            })
    }
    var modal = document.getElementById("alimentos");
    var span = modal.querySelector(".close");
    span.onclick = function(){
        modal.close();
        modal.style.display='none';
    }
    window.onclick=function(event){
        if(event.target == modal){
            modal.close();
            modal.style.display='none';
        }
    }
    function fetchCategoryData(category){
        url="/api/foods/?category=" + category
        tipoActual = category;
        fetch(url)
        .then(response => response.json())
        .then(data => {
            if(data.error){
                //console.log(categoryData);
                
                alert("Aun no hay datos registrados en esa categoría")
            } else {
                fillModalWithData(data); 
            }
        })
        .catch(error => console.error('Error fetching JSON:',error));
    }
    function openIngredientDialog(){
        fetchCategoryData(1);
        const alertDialog = document.querySelector("#alimentos");
        alertDialog.showModal();
    }
    async function fillModalWithData(categoryData){
        var modelData = '';
            modelData = `<table class="table table-hover" id="tablaModal">
        <thead>
            <tr class="titulo">
                <th>ID</th>
                <th class="sticky">Nombre</th>
                <th>Tipo</th>
                <th>Unidad</th>
                <th>Porción</th>
                <th>Peso</th>
                <th>Peso neto</th>
                <th>Energía (kcal)</th>
                <th>Proteína (g)</th>
                <th>Lípidos (g)</th>
                <th>Carbohidratos (g)</th>
                <th>AG saturados (g)</th>
                <th>AG monoinsaturados (g)</th>
                <th>AG poliinsaturados (g)</th>
                <th>Colesterol (g)</th>
                <th>Azúcar (g)</th>
                <th>Fibra (g)</th>
                <th>Vitamina A (mg RE)</th>
                <th>Ácido Ascórbico (mg)</th>
                <th>Ácido Fólico (mg)</th>
                <th>Calcio (mg)</th>
                <th>Hierro (mg)</th>
                <th>Potasio (mg)</th>
                <th>Sodio (mg)</th>
                <th>Fósforo (mg)</th>
                <th>Etanol (g)</th>
                <th>IG</th>
                <th>Carga Glicémica</th>
            </tr>
        </thead>
        <tbody id="food-table-body">
                        `;
            /*for(var key in categoryData){
                var item = categoryData[key];
                modelData += `
                    <tr>
                        <td>${key}</td>
                        <td>${item.Categoría}</td>
                        <td>${item.Unidad}</td>
                        <td>${item.Porcion}</td>
                        <td>${item.Energia}</td>
                        <td>${item.Proteina}</td>
                        <td>${item.Lipidos}</td>
                        <td>${item.HidratosDeCarbono}</td>
                    </tr>
                `;
            }*/
           categoryData.forEach(item => {
                const tipoNombre = item.tipo_nombre;
                const unidadId = item.unidad;
                const unidadNombre = item.unidad_nombre;

                modelData += `
                    <tr>
                         <td> ${item.id}</td>
                          <td class="sticky" id="nombre"> ${item.nombre}</td>
                           <td>  ${tipoNombre}</td>
                           <td>  ${item.porcion}</td>
                           <td>  ${unidadNombre}</td>
                            <td>  ${item.peso}</td>
                            <td>  ${item.peso_neto}</td>
                            <td>  ${item.energia}</td>
                            <td>  ${item.proteina}</td>
                            <td>  ${item.lipidos}</td>
                            <td>  ${item.carbos}</td>
                            <td>  ${item.ag_satur}</td>
                            <td>  ${item.ag_mono}</td>
                            <td>  ${item.ag_poli}</td>
                            <td>  ${item.colesterol}</td>
                            <td>  ${item.azucar}</td>
                            <td>  ${item.fibra}</td>
                            <td>  ${item.vita_A}</td>
                            <td>  ${item.aci_asc}</td>
                            <td>  ${item.aci_foli}</td>
                            <td>  ${item.calcio}</td>
                            <td>  ${item.hierro}</td>
                            <td>  ${item.potasio}</td>
                            <td>  ${item.sodio}</td>
                            <td>  ${item.fosforo}</td>
                            <td>  ${item.etanol}</td>
                            <td>  ${item.ig}</td>
                            <td>  ${item.carga_gli}</td>`
                    });
           
                            modelData += `</table>`
        document.getElementById('modalContent').innerHTML=modelData;
        document.getElementById('alimentos').style.display='block'
    }
    
    async function getUnidadName(unidadId){
        try{
            const response = await fetch('api/units/?id=${unidadId}');
            const data = await response.json();
            return data.unidad;
        } catch (error){
            console.error('Error fetching unidad name:', error);
            return 'Unknown';
        }
    }

// aqui inicia

function filtrarTabla() {
    debugger
  //  console.log("estoy dentro")
    // Obtener el valor de búsqueda y convertirlo a minúsculas
    let input = document.getElementById('inputBuscar');
    
    let filter = input.value.toLowerCase();
    console.log("soy filter ,", filter)
    // Obtener la tabla y sus filas
    let table = document.getElementById('tablaModal');
    //console.log(table)
    let tr = table.getElementsByTagName('tr');
    //console.log("inicio")
    //console.log(tr)
    
    // Recorrer todas las filas de la tabla (excepto el encabezado)
    for (let i = 1; i < tr.length; i++) {
        // Obtener el <td> con la clase 'sticky' y 'nombre' de la fila actual
        let td = tr[i].getElementsByClassName('sticky')[0];
        
        if (td) {
            // Obtener solo el texto del <td>
            let txtValue1 = td.textContent || td.innerText;
            let txtValue = txtValue1.substring(1) 
            console.log(txtValue)
            console.log(`Fila ${i}, contenido de td: ${txtValue.toLowerCase()}`);
            
            // Comprobar si el contenido del <td> coincide exactamente con el valor de búsqueda
            if (filter === '' || txtValue.toLowerCase().includes(filter)) {
                tr[i].style.display = "";  // Mostrar la fila si hay coincidencia
            } else {
                tr[i].style.display = "none";  // Ocultar la fila si no hay coincidencia
            }
        } else {
            console.log(`Fila ${i} no tiene un <td> con la clase 'nombre'.`);
        }
    }
}
//aqui acaba

</script>
{% else %}
<div class="contenido">
    <h1>Al parecer aun no cuentas con un menu asignado. Agenda cita con uno de nuestros especialistas hoy mismo para que asignen un plan alimenticio pensado para ti.</h1>
    <button onclick="window.location.href = 'listarespecialistas/'">Agendar Cita con especialista</button>
</div>
{% endif %}
{% endblock %}